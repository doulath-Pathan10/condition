import { FieldsetModel, KeyWithAnyModel } from '../../utils/model/common-model';
import { store } from '../../utils/store/store';

const rulesUtils = (props: KeyWithAnyModel, validationObj: any) => {
    const result = props.map((element: Array<FieldsetModel>) => {
        return element && element.map((res: FieldsetModel) => {
            const eFields = res.fields.map((res: KeyWithAnyModel) => {
                return {
                    ...res,
                    editable: validationObj.nonEditable[0] && validationObj.nonEditable[0].includes(res.logical_field_name) ? true : false
                }
            })
            const default_visibility_no_field = [
                "monthly_installment_mortgage_payment",
                "total_outstanding_other_loan_amount",
                "total_outstanding_other_monthly_payment",
                "direct_marketing_opt_out",
                "oth_bank_name",
                "oth_bank_number",
                "name_of_employer",
                "business_est_date"
            ]
            const productCategory = store.getState().stages.stages[0].stageInfo.products[0].product_category;
            const productType = store.getState().stages.stages[0].stageInfo.products[0].product_type;
            const casaSegment = store.getState().stages.stages[0].stageInfo.applicants[0].casaSegment;
            const asimilesCard = store.getState().stages.stages[0].stageInfo.applicants[0].asiaMilesCard;
            const campaignID = store.getState().stages.stages[0].stageInfo.products[0].campaign;

            const fullname = store.getState()?.stages?.stages?.[0]?.stageInfo?.applicants?.[0].full_name_a_1;
            if (productCategory === "CC") {
                if (fullname?.length > 19) {
                    default_visibility_no_field.push("embossed_name")
                }
                if (productType === "1313" && casaSegment === "Y") {
                    default_visibility_no_field.push("preferred_relationship_branch_EA", "tin_hkid");
                    // if(store.getState()?.stages?.stages?.[0]?.stageInfo?.applicants?.[0].tax_resident_of_any_country_region_a_1 === "HK") {
                    //     default_visibility_no_field.push("tin_hkid");
                    // }
                }
                if (productType === "1313" && (campaignID === 'HKSOZ01MCWB000' || campaignID === 'HKSOZ02MCWB000') && casaSegment === 'Y') {
                    default_visibility_no_field.push("rewards_choice_segment");
                }
                default_visibility_no_field.push("estatement_fee")
            }
            const mandatoryField = ['office_phone_number', 'business_est_date', "monthly_installment_mortgage_payment"]
            eFields.map((subElement: KeyWithAnyModel) => {
                if (default_visibility_no_field.indexOf(subElement.logical_field_name) > -1) {
                    subElement.default_visibility = null;
                }
                if (mandatoryField.indexOf(subElement.logical_field_name) > -1) {
                    subElement.mandatory = 'Yes';
                }
                let hiddenFields;
                if (productCategory === "CC") {
                    hiddenFields = ["place_of_birth", "purpose_of_account", "currency"];
                    if (productType === "1313" && casaSegment === "Y") {
                        hiddenFields = ["currency"]
                    }
                } else {
                    hiddenFields = ["place_of_birth", "purpose_of_account", "temp_cli_label", "enotice_label", "credit_limit_extension", "estatement", "note_credit", "estatement_fee"];
                }

                if (hiddenFields.indexOf(subElement.logical_field_name) > -1) {
                    subElement.default_visibility = 'No';

                }
            });
            const vFields = eFields.filter((subElement: KeyWithAnyModel) => (subElement.default_visibility !== 'No'));
            return { ...res, fields: vFields }
        })
    })
    return result[0]
}

export default rulesUtils

Please write an test cases using react and jest
